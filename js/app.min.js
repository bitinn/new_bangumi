"use strict";function getDomain(a){var b=/^https{0,}:\/\/\w+\.(\w+)\.\w+/i;return a.match(b)[1].toLowerCase()}angular.module("BangumiList",["ieFix","ngProgressLite"]).controller("ListController",["$scope","$http","ngProgressLite",function(b,g,a){var d,c,f,e;b.reversed=true;b.ordered="cn";b.navList=[{name:"星期一",index:1,order:"cn"},{name:"星期二",index:2,order:"cn"},{name:"星期三",index:3,order:"cn"},{name:"星期四",index:4,order:"cn"},{name:"星期五",index:5,order:"cn"},{name:"星期六",index:6,order:"cn"},{name:"星期日",index:0,order:"cn"},{name:"全部",index:undefined,order:"jp"}];b.order=function(i,l,h){var j="weekDay"+l.toUpperCase(),k="time"+l.toUpperCase();b.reversed=!h;b.ordered=l;h=h?-1:1;return i.sort(function(n,m){if(n[j]===m[j]){return h*(n[k]-m[k])}else{return h*((n[j]===0?7:n[j])-(m[j]===0?7:m[j]))}})};b.monthToSeason=function(h){switch(true){case (h<4):return 1;case (h<7):return 4;case (h<10):return 7;case (h<=12):return 10;default:throw new Error("failed convrting to season")}};b.getJsonPath=function(o,p,n){for(var m in n){if(n[m].year==o){var h=n[m].months;b.yearRead=n[m].year;b.monthRead=b.monthToSeason(p);for(var k=0,j=h.length;k<j;k++){if(b.monthRead===h[k].month&&h[k].json){return h[k].json}}if(b.monthRead===1){return b.getJsonPath(o-1,10,n)}else{return b.getJsonPath(o,p-3,n)}}}return b.getJsonPath(o-1,p,n)};b.readBangumi=function(j,h,i){a.start();g.get(j).success(function(k){b.bangumis=b.order(k,h,i);b.query.titleCN="";a.done()}).error(function(l,k){alert("读取"+j+"出错\n错误代码:"+k+"\n请联系wxt2005#gmail.com\n或在Twitter上@wxt2005")})};g.get("json/archive.json").success(function(j,h,k){d=k("Date")?new Date(k("Date")):new Date();c=d.getDay();f=d.getFullYear();e=d.getMonth()+1;b.query={weekDayCN:c};for(var i in j){j[i].show=j[i].year==f?true:false}b.archive=j;b.readBangumi(b.getJsonPath(f,e,j),b.ordered,!b.reversed)}).error(function(i,h){alert("读取archive.json出错\n错误代码:"+h+"\n请联系wxt2005#gmail.com\n或在Twitter上@wxt2005")})}]).filter("weekday",function(){var a=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return function(b){return a[b]}}).filter("time",function(){return function(a){return a?a.slice(0,2)+":"+a.slice(2):"(预计)"}}).filter("monthCN",function(){return function(a){switch(+a){case 1:return"一月";case 4:return"四月";case 7:return"七月";case 10:return"十月";default:throw new Error("failed to convert month")}}}).filter("onair",function(){return function(a){switch(getDomain(a)){case"youku":return"优酷";case"sohu":return"搜狐";case"qq":return"腾讯";case"iqiyi":return"爱奇艺";case"letv":return"乐视";case"pptv":return"PPTV";case"tudou":return"土豆";case"bilibili":return"B站";case"acfun":return"A站";case"movie":return"迅雷";default:return"未知"}}}).filter("orderLink",function(){return function(a){a.sort(function(d,c){d=getDomain(d);c=getDomain(c);if(d<c){return -1}else{if(d>c){return 1}else{return 0}}});return a}});