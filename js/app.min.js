"use strict";function getDomain(a){var b=/^https{0,}:\/\/\w+\.(\w+)\.\w+/i;return a.match(b)[1].toLowerCase()}angular.module("BangumiList",["ieFix","ngProgressLite","ipCookie"]).controller("ListController",["$scope","$http","ngProgressLite","ipCookie",function(b,h,a,d){var e,c,g,f;b.ipCookie=d;b.reversed=true;b.ordered="cn";b.navList=[{name:"周一",index:1,order:"cn"},{name:"周二",index:2,order:"cn"},{name:"周三",index:3,order:"cn"},{name:"周四",index:4,order:"cn"},{name:"周五",index:5,order:"cn"},{name:"周六",index:6,order:"cn"},{name:"周日",index:0,order:"cn"},{name:"全部",index:undefined,order:"jp"}];b.siteList=[{name:"A站",domain:"acfun",show:true},{name:"B站",domain:"bilibili",show:true},{name:"搜狐",domain:"sohu",show:true},{name:"优酷",domain:"youku",show:true},{name:"腾讯",domain:"qq",show:true},{name:"爱奇艺",domain:"iqiyi",show:true},{name:"乐视",domain:"letv",show:true},{name:"PPTV",domain:"pptv",show:true},{name:"土豆",domain:"tudou",show:true},{name:"迅雷",domain:"movie",show:true}];b.query={};b.getSiteCookie=function(i){return i.map(function(j){var k=d(j.domain);if(k!==undefined){j.show=k}return j})};b.siteList=b.getSiteCookie(b.siteList);b.query.newBgm=d("newOnly");b.order=function(j,m,i){var k="weekDay"+m.toUpperCase(),l="time"+m.toUpperCase();b.reversed=!i;b.ordered=m;i=i?-1:1;return j.sort(function(o,n){if(o[k]===n[k]){return i*(o[l]-n[l])}else{return i*((o[k]===0?7:o[k])-(n[k]===0?7:n[k]))}})};b.monthToSeason=function(i){switch(true){case (i<4):return 1;case (i<7):return 4;case (i<10):return 7;case (i<=12):return 10;default:throw new Error("failed convrting to season")}};b.getJsonPath=function(p,q,o){for(var n in o){if(o[n].year==p){var j=o[n].months;b.yearRead=o[n].year;b.monthRead=b.monthToSeason(q);for(var m=0,k=j.length;m<k;m++){if(b.monthRead===j[m].month&&j[m].json){return j[m].json}}if(b.monthRead===1){return b.getJsonPath(p-1,10,o)}else{return b.getJsonPath(p,q-3,o)}}}return b.getJsonPath(p-1,q,o)};b.readBangumi=function(k,i,j){a.start();h.get(k).success(function(l){b.bangumis=b.order(l,i,j);b.query.titleCN="";a.done()}).error(function(m,l){alert("读取"+k+"出错\n错误代码:"+l+"\n请联系wxt2005#gmail.com\n或在Twitter上@wxt2005")})};h.get("json/archive.json").success(function(k,i,l){e=l("Date")?new Date(l("Date")):new Date();c=e.getDay();g=e.getFullYear();f=e.getMonth()+1;b.query.weekDayCN=c;for(var j in k){k[j].show=k[j].year==g?true:false}b.archive=k;b.readBangumi(b.getJsonPath(g,f,k),b.ordered,!b.reversed)}).error(function(j,i){alert("读取archive.json出错\n错误代码:"+i+"\n请联系wxt2005#gmail.com\n或在Twitter上@wxt2005")})}]).filter("weekday",function(){var a=["周日","周一","周二","周三","周四","周五","周六"];return function(b){return a[b]}}).filter("time",function(){return function(a){return a?a.slice(0,2)+":"+a.slice(2):"(预计)"}}).filter("monthCN",function(){return function(a){switch(+a){case 1:return"一月";case 4:return"四月";case 7:return"七月";case 10:return"十月";default:throw new Error("failed to convert month")}}}).filter("onair",function(){return function(a){switch(getDomain(a)){case"youku":return"优酷";case"sohu":return"搜狐";case"qq":return"腾讯";case"iqiyi":return"爱奇艺";case"letv":return"乐视";case"pptv":return"PPTV";case"tudou":return"土豆";case"bilibili":return"B站";case"acfun":return"A站";case"movie":return"迅雷";default:return"未知"}}}).filter("linkFilter",function(){return function(c,a){var b=[];b=c.filter(function(f){for(var e=0,d=a.length;e<d;e++){if(a[e].domain===getDomain(f)){return a[e].show}}return false});return b.sort(function(e,d){e=getDomain(e);d=getDomain(d);if(e<d){return -1}else{if(e>d){return 1}else{return 0}}})}});