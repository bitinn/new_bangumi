"use strict";$(function(){$("noscript").remove();var ae=0,ac=0,ab=0;var aa=0,Y=0,X=0;var J=0,Q=0,s=0,c=0;var Z=0,h=0;var M=null;var O=["周日","周一","周二","周三","周四","周五","周六"];var y=["日曜","月曜","火曜","水曜","木曜","金曜","土曜"];var f={list:[{name:"A站",domain:"acfun",show:true},{name:"B站",domain:"bilibili",show:true},{name:"搜狐",domain:"sohu",show:true},{name:"优酷",domain:"youku",show:true},{name:"腾讯",domain:"qq",show:true},{name:"爱奇艺",domain:"iqiyi",show:true},{name:"乐视",domain:"letv",show:true},{name:"PPTV",domain:"pptv",show:true},{name:"土豆",domain:"tudou",show:true},{name:"迅雷",domain:"movie",show:true}],turnAll:function(j){var i=[];for(ab=0,X=this.list.length;ab<X;ab++){if(this.list[ab].show!==j){this.list[ab].show=j;i.push(this.list[ab].domain)}}return i},show:function(j,i){for(ab=0,X=this.list.length;ab<X;ab++){if(this.list[ab].name===j||this.list[ab].domain===j){if(i!==undefined){this.list[ab].show=i}return this.list[ab].show}}return undefined}};var x=$("#bangumiList");var T=$("#shadow");var K=$("#switcher");var W=$("table th:eq(1) p");var o=$("table th:eq(2) p");var e=$("#search input");var P=$("#topnav");var A=P.find(".menu");var af=A.children("a");var H=A.find(".submenu");var I=$("#hourSelecter");var ah=null,B=null;var N={reverse:true,ordered:"CN",switchInit:7,switchLog:7,weekDay:-1,nextTime:24,title:"",lastModified:"",showAll:false,history:false,newTab:false,jpTime:false,jpTimeZone:8,jpTitle:false,showNew:false};function E(i){switch(i){case"true":return true;case"false":return false;default:return !!i}}function ai(i,j){switch(j.toLowerCase()){case"cn":return O[i];case"jp":return y[i];default:return O[i]}}function S(i){if(i===-1){return"(未知)"}else{return i?i.slice(0,2)+":"+i.slice(2):"(预计)"}}function U(i){switch(true){case (i<4):return 1;case (i<7):return 4;case (i<10):return 7;case (i<=12):return 10;default:throw new Error("failed convrting to season")}}function u(){var j=0;var i=P.find(".sites :checkbox");for(ae=0,aa=i.length;ae<aa;ae++){if(f.show(i.get(ae).id)){i.eq(ae).attr("checked",true).prev().find("span").addClass("ON");j++}else{i.eq(ae).attr("checked",false).prev().find("span").removeClass("ON")}}if(j===i.length){$("#selectAll").text("全不选")}else{$("#selectAll").text("全选")}}function ad(i){var j=/^https{0,}:\/\/\w+\.(\w+)\.\w+/i;if(i!=="#"){return i.match(j)[1].toLowerCase()}else{return""}}function w(k,l,j){Z=k;h=U(l);for(ae=0,aa=j.length;ae<aa;ae++){if(j[ae].year===k){var i=j[ae].months;for(ac=0,Y=i.length;ac<Y;ac++){if(h===i[ac].month&&i[ac].json){return i[ac].json}}if(h===1){return w(k-1,10,j)}else{return w(k,l-3,j)}}}return w(k-1,l,j)}function D(j,i){j=b(ad(j));i=b(ad(i));if(j.length===i.length){if(j<i){return -1}else{if(j>i){return 1}else{return 0}}}else{return j.length-i.length}}function b(i){switch(i){case"youku":return"优酷";case"sohu":return"搜狐";case"qq":return"腾讯";case"iqiyi":return"爱奇艺";case"letv":return"乐视";case"pptv":return"PPTV";case"tudou":return"土豆";case"bilibili":return"B站";case"acfun":return"A站";case"movie":return"迅雷";default:return"未知"}}function d(i){x.empty();x.append(i);x.find(".links li:last-child").addClass("last");t()}function V(i){return function(k,j,l){$(this).parents("tr").find("p").removeClass("ordered");$(this).addClass("ordered");if(j!==undefined){r(B,j,i)}else{r(B,!N.reverse,i)}d(v(B));if(!l){C()}}}function g(){var j="";var i=null;for(ae=0,aa=f.list.length;ae<aa;ae++){j+='<li><label for="'+f.list[ae].domain+'">'+f.list[ae].name+'<span class="toggle"></span></label><input type="checkbox" name="'+f.list[ae].domain+'" id="'+f.list[ae].domain+'"></li>'}i=$(j);i.find(":checkbox").change(function(){f.show(this.id,this.checked);u();d(v(B));N.ordered="CN";K.trigger("click",[N.switchLog,true]);$.cookie(this.id,this.checked,{expires:365})});P.find(".sites").prepend(i)}function r(m,k,aj){var j="",n="";var i=(k?-1:1);var l=0,ak=0;N.reverse=k;N.ordered=aj;if(aj){j="weekDay"+aj.toUpperCase();n="time"+aj.toUpperCase()}else{j="weekDayCN";n="timeCN"}m.sort(function(am,al){if(am[j]===al[j]){l=(am[n]===""?-1:+am[n]);ak=(al[n]===""?-1:+al[n]);if(l===ak){return i*(am.officalSite-al.officalSite)}else{return i*(l-ak)}}else{return i*(am[j]-al[j])}})}function v(j){var i="",k="";for(ae=0,aa=j.length;ae<aa;ae++){i+='<tr><td><a href="'+j[ae].officalSite+'" title="'+(N.jpTitle?j[ae].titleCN:j[ae].titleJP)+(j[ae].newBgm?'" class="new">':'">')+(N.jpTitle?j[ae].titleJP:j[ae].titleCN)+"</a></td><td>"+(j[ae].comment?'<div class="comment"><div class="tooltip">'+j[ae].comment+"</div></div>":"")+'</td><td><span class="weekDay">'+ai(j[ae].weekDayJP,(N.jpTime?"jp":"cn"))+'</span><span class="time">'+S(j[ae].timeJP)+'</span></td><td><span class="weekDay">'+ai(j[ae].weekDayCN,"cn")+'</span><span class="time">'+S(j[ae].timeCN)+"</span></td>";if(j[ae].onAirSite.length){k="";j[ae].onAirSite.sort(D);i+='<td><ul class="links">';for(ac=0,Y=j[ae].onAirSite.length;ac<Y;ac++){if(f.show(ad(j[ae].onAirSite[ac]))){if(ac===Y-1){k+="<li>"}else{k+="<li>"}k+='<a href="'+j[ae].onAirSite[ac]+'" target="_self">'+b(ad(j[ae].onAirSite[ac]))+"</a></li>"}}if(k===""){k+='<li class="empty">过滤</li>'}i+=k+"</ul></td></tr>"}else{i+='<td><ul class="links"><li class="empty">暂无</li></ul></td></tr>'}}return i}function G(l){var k="";var j=null;for(ae=0,aa=l.length;ae<aa;ae++){var i=l[ae].months;k+='<li><a href="#">'+l[ae].year+'年</a><ul class="submenu month">';for(ac=0,Y=i.length;ac<Y;ac++){k+='<li><a href="#" data-json="'+i[ac].json+'">'+i[ac].month+"月</a></li>"}k+="</ul></li>"}j=$(k);j.each(function(){$(this).hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()}).find("ul").hide()});j.find("ul a").click(function(){var m=$(this).data("json");N.history=true;q(m);Z=+("20"+m.match(/(\d{2})(\d{2})/)[1]);h=+(m.match(/(\d{2})(\d{2})/)[2]);$(this).parents(".submenu").hide();return false});P.find("li ul.year").append(j)}function C(){var j=x.find("tr");var i=0;j.detach();for(ae=0,aa=j.length;ae<aa;ae++){if(N.showNew&&j.eq(ae).find(".new").length){j.eq(ae).find(".new").addClass("hideMark")}else{j.eq(ae).find(".new").removeClass("hideMark")}if(z(j.eq(ae))){j.eq(ae).show();i++}else{j.eq(ae).hide()}}j.appendTo(x);if(i===0){$('<tr><td colspan="5">无结果</td></tr>').appendTo(x)}}function t(){x.find(".comment").click(function(){var i=$(this).find("div");if(i.css("display")==="block"){i.fadeOut(200)}else{if($(this).position().top<=i.innerHeight()*2){i.addClass("opposite");i.fadeIn(200)}else{i.fadeIn(200)}}}).hover(function(){var i=$(this).find("div");if($(this).position().top<=i.innerHeight()*2){i.addClass("opposite")}i.fadeIn(200)},function(){$(this).find("div").fadeOut(200)})}function L(i){if(i){x.find("a").attr("target",i)}else{x.find("a").attr("target","_self")}}function a(){I.find("span").removeClass("disable");if(N.nextTime===24){I.find(".right").addClass("disable")}else{if(N.nextTime===20){I.find(".left").addClass("disable")}}I.find("p").text(N.nextTime+"点")}function z(m){var l=false;var k=m.find("td:eq(3) .weekDay").text();var i=+(m.find("td:eq(3) .time").text().slice(0,2));if(!i){i=0}if(N.weekDay===-1){l=true}else{if((k===O[N.weekDay]&&i<N.nextTime)||(k===O[(N.weekDay===0?6:N.weekDay-1)]&&i>=N.nextTime)){l=true}}if(N.showNew&&!(m.find("td:eq(0) a").is(".new"))){l=false}if(N.title){var j=new RegExp("\\"+N.title,"i");var n=m.find("td:eq(0) a");if(!j.test(n.text())&&!j.test(n.attr("title"))){l=false}}return l}function p(j){var k=K.find("li:eq("+j+")");var i=k.text();k.text("今天");k.hover(function(){$(this).text(i)},function(){$(this).text("今天")})}function R(){if($.cookie("showNew")!==undefined){N.showNew=$.cookie("showNew",E)}if(N.showNew){P.find("#showNew").attr("checked",true).prev().find("span").addClass("ON")}if($.cookie("showAll")!==undefined){N.showAll=$.cookie("showAll",E)}if(N.showAll){P.find("#showAll").attr("checked",true).prev().find("span").addClass("ON")}if($.cookie("newTab")!==undefined){N.newTab=$.cookie("newTab",E)}if(N.newTab){P.find("#newTab").attr("checked",true).prev().find("span").addClass("ON")}if($.cookie("jpTime")!==undefined){N.jpTime=$.cookie("jpTime",E)}if(N.jpTime){P.find("#jpTime").attr("checked",true).prev().find("span").addClass("ON")}if($.cookie("jpTitle")!==undefined){N.jpTitle=$.cookie("jpTitle",E)}if(N.jpTitle){P.find("#jpTitle").attr("checked",true).prev().find("span").addClass("ON")}if($.cookie("nextTime")!==undefined){N.nextTime=$.cookie("nextTime",Number)}a();for(ae=0,aa=f.list.length;ae<aa;ae++){if($.cookie(f.list[ae].domain)!==undefined){f.list[ae].show=$.cookie(f.list[ae].domain,E)}}}function ag(){var i=document.cookie.match(/[^ =;]+(?=\=)/g);if(i){for(ae=0,aa=i.length;ae<aa;ae++){$.removeCookie(i[ae])}}location.reload(true)}function F(n,j){var m=j-N[n.toLowerCase()+"TimeZone"];var l="time"+n.toUpperCase();var aj="weekDay"+n.toUpperCase();var k,i;for(ae=0,aa=B.length;ae<aa;ae++){k=+B[ae][l].slice(0,2);i=+B[ae][aj];k=k+m;if(k<0){k+=24;i--}else{if(k>=24){k-=24;i++}}if(k<10){k="0"+k}if(i<0){i+=7}else{if(i>6){i-=7}}B[ae][l]=k+B[ae][l].slice(2);B[ae][aj]=i+""}N[n.toLowerCase()+"TimeZone"]=j}function q(i){T.show();$.ajax({url:i,success:function(l,k,m){B=l;R();if(N.history){N.jpTimeZone=8}if(N.jpTime){F("jp",9)}if(N.history||N.showAll){K.trigger("click",[7,true,true])}else{K.trigger("click",[N.switchInit,true,true])}C();if(N.newTab){L("_blank")}g();u();if(m.getResponseHeader("Last-Modified")){var j=new Date(m.getResponseHeader("Last-Modified"));N.lastModified="数据更新日期: "+j.getFullYear()+"年"+(j.getMonth()+1)+"月"+j.getDate()+"日"}$("#header h1").text(Z+"年"+h+"月番组");$("#header .total").text("当季共有"+l.length+"部番组");$("#header .lastModified").text(N.lastModified);T.fadeOut(200)},error:function(l,k,j){x.append('<tr><td colspan="4">读取 '+i+" 出错，错误代码："+l.status+" "+j+"</td></tr>")}})}$.ajax({url:"json/archive.json",success:function(j,i,k){J=(k.getResponseHeader("Date")?new Date(k.getResponseHeader("Date")):new Date());s=J.getFullYear();c=J.getMonth()+1;Q=J.getDay();N.switchInit=(Q===0?6:Q-1);p(N.switchInit);ah=j;q(w(s,c,j));G(j)},error:function(k,j,i){x.append('<tr><td colspan="4">读取 json/archive.json 出错，错误代码：'+k.status+" "+i+"</td></tr>")}});K.click(function(l,k,m,j){var i=$(l.target);if(l.target!==this||m){K.find("li").removeClass("selected");if(k!==undefined){K.find("li:eq("+k+")").addClass("selected")}else{k=i.index();i.addClass("selected")}N.switchLog=k;if(k===6){N.weekDay=0}else{if(k===7){N.weekDay=-1}else{N.weekDay=k+1}}if(k===7&&(N.ordered!=="JP"||N.reverse!==false)){W.trigger("click",[false,true])}else{if(N.ordered!=="CN"||N.reverse!==false){o.trigger("click",[false,true])}}if(!j){C()}}});o.click(V("CN"));W.click(V("JP"));af.click(function(i){var j=$(this).next();if(j.css("display")==="block"){j.fadeOut(200);T.fadeOut(200)}else{H.hide();j.fadeIn(200);T.fadeIn(200)}return false});e.keyup(function(i){if(i.target.value.length===1){K.trigger("click",[7,true,true])}$(this).next().show();N.title=$(this).val();C();if(i.keyCode===27){$(this).blur().val("");N.title="";if(N.showAll||N.history){K.trigger("click",[7,true])}else{K.trigger("click",[N.switchInit,true])}$(this).next().hide()}else{if(i.keyCode===8&&i.target.value.length<=0){if(N.showAll||N.history){K.trigger("click",[7,true])}else{K.trigger("click",[N.switchInit,true])}$(this).next().hide()}}}).next().hide().click(function(){e.blur().val("");N.title="";K.trigger("click",[N.switchInit,true]);$(this).hide()});$("#showNew").change(function(){if(this.checked){$(this).prev().find("span").addClass("ON")}else{$(this).prev().find("span").removeClass("ON")}N.showNew=this.checked;$.cookie("showNew",this.checked,{expires:365});C()});$("#showAll").change(function(){if(this.checked){$(this).prev().find("span").addClass("ON")}else{$(this).prev().find("span").removeClass("ON")}N.showAll=this.checked;if(this.checked){K.trigger("click",[7,true])}else{K.trigger("click",[N.switchInit,true])}$.cookie("showAll",this.checked,{expires:365});C()});$("#newTab").change(function(){if(this.checked){$(this).prev().find("span").addClass("ON")}else{$(this).prev().find("span").removeClass("ON")}N.newTab=this.checked;$.cookie("newTab",this.checked,{expires:365});L((N.newTab?"_blank":"_self"))});$("#jpTime").change(function(){if(this.checked){$(this).prev().find("span").addClass("ON")}else{$(this).prev().find("span").removeClass("ON")}N.jpTime=this.checked;$.cookie("jpTime",this.checked,{expires:365});if(N.jpTime){F("jp",9)}else{F("jp",8)}d(v(B));C()});$("#jpTitle").change(function(){if(this.checked){$(this).prev().find("span").addClass("ON")}else{$(this).prev().find("span").removeClass("ON")}N.jpTitle=this.checked;$.cookie("jpTitle",this.checked,{expires:365});d(v(B));C()});I.find("span").click(function(i){if(i.target.className==="right"&&N.nextTime<24){N.nextTime++;C()}else{if(i.target.className==="left"&&N.nextTime>20){N.nextTime--;C()}}a();$.cookie("nextTime",N.nextTime,{expires:365})});$("#reset").click(ag);$("#selectAll").click(function(){var i=null;if($(this).text()==="全选"){i=f.turnAll(true)}else{if($(this).text()==="全不选"){i=f.turnAll(false)}}d(v(B));K.trigger("click",[N.switchLog,true]);u();for(ae=0,aa=i.length;ae<aa;ae++){$.cookie(i[ae],f.show(i[ae]),{expires:365})}});T.click(function(){$(this).fadeOut(200);H.hide()});P.find(".share a").click(function(){window.open(this.href,"","height=420, width=550, scrollbars=yes");return false})});