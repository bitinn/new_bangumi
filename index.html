<!DOCTYPE html>
<html id="ng-app" ng-app="BangumiList">
    <head>
        <meta charset="utf-8">
        <title>番组放送</title>
        <link type="text/css" rel="stylesheet" href="css/main.css">
        <!--[if lte IE 7]><script type="text/javascript" src="js/json2.js"></script><![endif]-->
    </head>
    <body ng-controller="ListController">
        <div id="topbar">
            <ul id="topnav">
                <li class="title">
                    <a href="http://bgmlist.com/">番组放送</a>
                </li>
                <li class="menu" ng-mouseenter="topMenuHandler('archive')" 
                    ng-mouseleave="topMenuHandler('archive')">
                    <a href="javascript:;" ng-click="topMenuHandler('archive')">历史数据</a>
                    <ul class="submenu year" ng-show="status.menu.archive" ng-cloak>
                        <li ng-repeat="file in archive">
                            <a href="javascript:;" ng-mouseenter="topMenuHandler('year'+file.year,true)" 
                                ng-mouseleave="topMenuHandler('year'+file.year,true)" 
                                ng-click="topMenuHandler('year'+file.year,true)">
                                {{file.year}}年
                            </a>
                            <ul class="submenu month" ng-show="$parent.status.menu['year'+file.year]"
                                ng-mouseenter="topMenuHandler('year'+file.year,true)" 
                                ng-mouseleave="topMenuHandler('year'+file.year,true)">
                                <li ng-repeat="data in file.months">
                                    <a href="javascript:;" 
                                        ng-click="archiveHandler(file.year,data.month)">
                                        {{data.month|monthCN}}
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="menu" ng-mouseenter="topMenuHandler('display')" 
                    ng-mouseleave="topMenuHandler('display')">
                    <a href="javascript:;" ng-click="topMenuHandler('display')">显示设置</a>
                    <ul class="submenu display" ng-show="status.menu.display" ng-cloak>
                        <li>
                            <label for="showNew" title="只在列表中显示当月开播的番组">只显示新番
                                <span class="toggle" ng-class="{'ON':query.showNew}"></span>
                            </label>
                            <input type="checkbox" name="showNew" id="showNew" 
                            ng-model="query.showNew" ng-change="newOnlyHandler()">
                        </li>
                        <li>
                            <label for="showAll" title="打开页面后直接显示全部番组">关闭自动切换
                                <span class="toggle" ng-class="{'ON':setting.showAll}"></span>
                            </label>
                            <input type="checkbox" name="showAll" id="showAll" 
                            ng-model="setting.showAll" ng-change="showAllHandler()">
                        </li>
                        <li>
                            <label for="newTab" title="在新窗口（标签）中打开所有链接，包括番组官网">打开新页面
                                <span class="toggle" ng-class="{'ON':setting.newTab}"></span>
                            </label>
                            <input type="checkbox" name="newTab" id="newTab" 
                            ng-model="setting.newTab" ng-change="changeTarget()">
                        </li>
                        <li>
                            <label for="toNextDay" title="将该时间点及之后的番组顺延到第二天显示">转到次日</label>
                            <div class="hourSelecter">
                                <span class="left" ng-click="hourSelectHandler('-')" 
                                    ng-class="{'disable':status.nextTime==='min'}"></span>
                                <p>{{query.nextTime}}点</p>
                                <span class="right" ng-click="hourSelectHandler('+')" 
                                    ng-class="{'disable':status.nextTime==='max'}"></span>
                            </div>
                        </li>
                        <li>
                            <span class="all" ng-click="clearCookie()" 
                                title="清除显示设置和站点过滤，下次打开本站时将使用默认设置">清除所有设置</span>
                        </li>
                    </ul>
                </li>
                <li class="menu" ng-mouseenter="topMenuHandler('sites')" ng-mouseleave="topMenuHandler('sites')">
                    <a href="javascript:;" ng-click="topMenuHandler('sites')">站点过滤</a>
                    <ul class="submenu sites" ng-show="status.menu.sites" ng-cloak>
                        <li ng-repeat="airSite in siteList">
                            <label for="{{airSite.domain}}">{{airSite.name}}
                                <span class="toggle" ng-class="{'ON':airSite.show}">
                                </span>
                            </label>
                            <input type="checkbox" name="{{airSite.domain}}" id="{{airSite.domain}}" 
                                ng-model="airSite.show" 
                                ng-change="siteHandler(airSite.domain,airSite.show)">
                        </li>
                        <li>
                            <span class="all" ng-click="selectAllHandler(status.selectAll)">
                                {{status.selectAll|selectAllButton}}
                            </span>
                        </li>
                    </ul> 
                </li>
                <li class="menu">
                    <a href="m&#97;i&#108;t&#111;:&#119;xt&#50;&#48;&#48;&#53;@gma&#105;l&#46;&#99;&#111;&#109;?subject=%e7%95%aa%e7%bb%84%e6%94%be%e9%80%81-%e9%94%99%e8%af%af%e6%8f%90%e4%ba%a4" 
                        title="如果您发现数据错误，或者其它问题，请联系我">提交问题</a>
                </li>
                <li class="share twitter">
                    <a href="https://twitter.com/share?url=http%3A%2F%2Fbgmlist.com%2F&text=%e6%96%b9%e4%be%bf%e5%bf%ab%e6%8d%b7%e7%9a%84%e6%ad%a3%e7%89%88%e6%96%b0%e7%95%aa%e6%94%be%e9%80%81%e8%81%9a%e5%90%88%e7%ab%99+-+%e7%95%aa%e7%bb%84%e6%94%be%e9%80%81" title="分享到Twitter" target="_blank">分享到Twitter</a>
                </li>
                <li class="share weibo">
                    <a href="http://service.weibo.com/share/share.php?title=%e6%96%b9%e4%be%bf%e5%bf%ab%e6%8d%b7%e7%9a%84%e6%ad%a3%e7%89%88%e6%96%b0%e7%95%aa%e6%94%be%e9%80%81%e8%81%9a%e5%90%88%e7%ab%99+-+%e7%95%aa%e7%bb%84%e6%94%be%e9%80%81&url=http%3A%2F%2Fbgmlist.com%2F" title="分享到微博" target="_blank">分享到微博</a>
                </li>
                <li class="share plain">
                    分享本站
                </li>

            </ul>
        </div>
        <div id="shadow" ng-click="shadowHandler()" ng-show="status.shadow"></div>
        <div id="header" ng-cloak>
            <h1>{{yearRead}}年{{monthRead}}月番组</h1>
            <p class="total">当季共有{{bangumis.length}}部番组</p>
            <p class="lastModified">{{status.lastModifieded}}</p>
        </div>
        <div id="nav">
            <ul id='switcher' ng-cloak>
                <li ng-repeat="switcher in switcherList" 
                    ng-class="{'selected':$parent.query.weekDayCN===switcher.index}" 
                    ng-click="switcherHandler(switcher.index,switcher.order)">{{switcher.name}}</li>
            </ul> 
            <div id="search">
                <input type="text" ng-model="query.titleCN" 
                placeholder="搜索本季度番组" ng-keydown="searchHandler($event)">
                <span class="clear" ng-show="query.titleCN!==''" ng-click="resumeSearch()">delete</span>
            </div>
        </div>
        <div id="container">
            <noscript>
                <p style="text-align:center;">请打开javascript支持以完整显示本站点</p>
            </noscript>
            <table ng-cloak>
                <colgroup>
                    <col id="name">
                    <col id="time-jp">
                    <col id="time-cn">
                    <col id="site">
                </colgroup>
                <thead>
                    <tr>
                        <th>作品名</th>
                        <th>
                            <span ng-click="order(bangumis,'jp',status.reversed)" 
                                ng-class="{'ordered':status.ordered==='jp'}">日本放送时间</span>
                        </th>
                        <th>
                            <span ng-click="order(bangumis,'cn',status.reversed)" 
                                ng-class="{'ordered':status.ordered==='cn'}">大陆放送时间</span>
                        </th>
                        <th>播放网址</th>
                    </tr>
                </thead>
                <tbody id="bangumi_list">
                    <tr class="errorMsg" ng-show="status.error">
                        <td colspan="4">{{status.errorMsg}}</td>
                    </tr>
                    <tr ng-repeat="item in bangumis|filter:bgmFilter track by $index">
                        <td>
                            <a href="{{item.officalSite}}" ng-class="{'new':item.newBgm}" title="{{item.titleJP}}"
                                target="{{status.linkTarget}}">
                                {{item.titleCN}}
                            </a>
                        </td>
                        <td>{{item.weekDayJP|weekday}}&#160;&#160;{{item.timeJP|time}}</td>
                        <td>{{item.weekDayCN|weekday}}&#160;&#160;{{item.timeCN|time}}</td>
                        <td>
                            <ul class="link-list">
                                <li ng-repeat="site in item.onAirSite|linkFilter:siteList" 
                                    ng-class="{'lastLink':$last}">
                                    <a href="{{site}}" target="{{status.linkTarget}}" ng-click="linkHandler(site,$event)" 
                                        ng-class="{'disabled':site==='#'}">
                                        {{site|onair}}
                                    </a>
                                </li>
                            </ul>    
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p id="footer">&copy; 
            <a href="http://bgmlist.com/">番组放送</a> &#124; All Rights Reserved &#124; Powered by 
            <a href="https://angularjs.org/">AngularJS</a>
            and <a href="https://github.com/wxt2005/new_bangumi/">GitHub</a>
        </p>
        <script type="text/javascript" src="js/angular.min.js"></script> 
        <script type="text/javascript" src="js/angular-cookie.min.js"></script> 
        <script type="text/javascript" src="js/app.js"></script> 
        <script type="text/javascript" src="js/iefix.js"></script> 
    </body>
</html>
