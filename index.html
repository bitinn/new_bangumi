<!DOCTYPE html>
<html id="ng-app" ng-app="BangumiList">
    <head>
        <meta charset="utf-8">
        <title>番组放送</title>
        <link type="text/css" rel="stylesheet" href="css/main.css">
        <link type="text/css" rel="stylesheet" href="css/ngprogress-lite.css">
    </head>
    <body ng-controller="ListController">
        <div id="topbar">
            <ul id=topnav>
                <li class="title">
                    <a href="http://bgmlist.com/">番组放送</a>
                </li>
                <li class="menu" ng-mouseenter="menuArchive=true;shadow=!shadow" 
                    ng-mouseleave="menuArchive=false;shadow=!shadow">
                    <a href="javascript:;" ng-click="menuArchive=!menuArchive;shadow=!shadow">历史数据</a>
                    <ul class="submenu year" ng-show="menuArchive===true" ng-cloak>
                        <li ng-repeat="file in archive">
                            <a href="javascript:;" ng-mouseenter="$parent['year'+file.year]=true" ng-mouseleave="$parent['year'+file.year]=false" 
                                ng-click="$parent['year'+file.year]=!$parent['year'+file.year]" ng-init="$parent['year'+file.year]=false">
                                {{file.year}}年
                            </a>
                            <ul class="submenu month" ng-show="$parent['year'+file.year]===true"
                                ng-mouseenter="$parent['year'+file.year]=true" ng-mouseleave="$parent['year'+file.year]=false">
                                <li ng-repeat="data in file.months">
                                    <a href="javascript:;" 
                                        ng-click="readBangumi(getJsonPath(file.year, data.month, archive),'jp',false);
                                        query.weekDayCN=-1;$parent.$parent.menuArchive=false;
                                        $parent.$parent.allData=true">
                                        {{data.month|monthCN}}
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="menu" ng-mouseenter="menuDisplay=true;shadow=!shadow" 
                    ng-mouseleave="menuDisplay=false;shadow=!shadow">
                    <a href="javascript:;" ng-click="menuDisplay=!menuDisplay;shadow=!shadow">显示设置</a>
                    <ul class="submenu display" ng-show="menuDisplay===true" ng-cloak>
                        <li>
                            <label for="newOnly" title="只在列表中显示当月开播的番组">只显示新番
                                <span ng-class="{'toggleON':query.newBgm,'toggleOFF':!query.newBgm}"></span>
                            </label>
                            <input type="checkbox" name="newOnly" id="newOnly" 
                            ng-model="query.newBgm" ng-false-value="" 
                            ng-change="ipCookie('newOnly',query.newBgm,{expires:365})">
                        </li>
                        <li>
                            <label for="allOnly" title="打开页面后直接显示全部番组">关闭自动切换
                                <span ng-class="{'toggleON':allOnly,'toggleOFF':!allOnly}"></span>
                            </label>
                            <input type="checkbox" name="allOnly" id="allOnly" 
                            ng-model="allOnly" 
                            ng-change="switchAllOnly();ipCookie('allOnly',allOnly,{expires:365})">
                        </li>
                        <li>
                            <label for="newWindow" title="在新窗口（标签）中打开所有链接，包括番组官网">打开新页面
                                <span ng-class="{'toggleON':newWindow,'toggleOFF':!newWindow}"></span>
                            </label>
                            <input type="checkbox" name="newWindow" id="newWindow" 
                            ng-model="newWindow" 
                            ng-change="changeTarget();ipCookie('newWindow',newWindow,{expires:365})">
                        </li>
                        <li>
                            <label for="toNextDay" title="将该时间点及之后的番组顺延到第二天显示">转到次日</label>
                            <div class="hourSelecter">
                                <span class="left" ng-click="changeNextDayTime('-');ipCookie('nextDayTime',query.nextDayTime,{expires:365})" 
                                    ng-class="{'disable':nextDayTimeFlag==='min'}"></span>
                                <p>{{query.nextDayTime}}点</p>
                                <span class="right" ng-click="changeNextDayTime('+');ipCookie('nextDayTime',query.nextDayTime,{expires:365})" 
                                    ng-class="{'disable':nextDayTimeFlag==='max'}"></span>
                            </div>
                        </li>
                        <li><span class="all" ng-click="clearCookie()" title="清除显示设置和站点过滤，下次打开本站时将使用默认设置">清除所有设置</span></li>
                    </ul>
                </li>
                <li class="menu" ng-mouseenter="menuSites=true;shadow=!shadow" 
                    ng-mouseleave="menuSites=false;shadow=!shadow">
                    <a href="javascript:;" ng-click="menuSites=!menuSites;shadow=!shadow">站点过滤</a>
                    <ul class="submenu sites" ng-show="menuSites===true" ng-cloak>
                        <li ng-repeat="airSite in siteList">
                            <label for="{{airSite.domain}}">{{airSite.name}}
                                <span class="toggleON" 
                                    ng-class="{'toggleON':airSite.show,'toggleOFF':!airSite.show}">
                                </span>
                            </label>
                            <input type="checkbox" name="{{airSite.domain}}" id="{{airSite.domain}}" 
                                ng-model="airSite.show" 
                                ng-change="ipCookie(airSite.domain,airSite.show,{expires:365});checkSiteList()">
                        </li>
                        <li><span class="all" ng-click="selectAll(selectFlag)">{{selectFlag|selectAllButton}}</span></li>
                    </ul> 
                </li>
                <li class="share twitter">
                    <a href="https://twitter.com/share?url=http%3A%2F%2Fbgmlist.com%2F&text=%e6%96%b9%e4%be%bf%e5%bf%ab%e6%8d%b7%e7%9a%84%e6%ad%a3%e7%89%88%e6%96%b0%e7%95%aa%e6%94%be%e9%80%81%e8%81%9a%e5%90%88%e7%ab%99+-+%e7%95%aa%e7%bb%84%e6%94%be%e9%80%81" title="分享到Twitter" target="_blank">分享到Twitter</a>
                </li>
                <li class="share weibo">
                    <a href="http://service.weibo.com/share/share.php?title=%e6%96%b9%e4%be%bf%e5%bf%ab%e6%8d%b7%e7%9a%84%e6%ad%a3%e7%89%88%e6%96%b0%e7%95%aa%e6%94%be%e9%80%81%e8%81%9a%e5%90%88%e7%ab%99+-+%e7%95%aa%e7%bb%84%e6%94%be%e9%80%81&url=http%3A%2F%2Fbgmlist.com%2F" title="分享到微博" target="_blank">分享到微博</a>
                </li>
                <li class="share plain">
                    分享本站
                </li>

            </ul>
        </div>
        <div id="shadow" ng-click="menuArchive=false;menuDisplay=false;menuSites=false" ng-show="shadow===true"></div>
        <div id="header" ng-cloak>
            <h1>{{yearRead}}年{{monthRead}}月番组</h1>
            <p class="total">当季共有{{bangumis.length}}部番组</p>
            <p class="lastModified">{{lastModified}}</p>
        </div>
        <div id="nav">
            <ul id='switcher' ng-cloak>
                <li ng-repeat="nav in navList" 
                    ng-class="{'selected':$parent.query.weekDayCN===nav.index}" 
                    ng-click="$parent.switcherHandler(nav.index,nav.order)">{{nav.name}}</li>
            </ul> 
            <div id="search">
                <input type="text" ng-model="query.titleCN" 
                placeholder="搜索本季度番组" ng-keydown="searchHandler($event)">
                <span class="clear" ng-show="query.titleCN!==''" ng-click="resumeSearch()">delete</span>
            </div>
        </div>
        <div id="container">
            <noscript>
                <p style="text-align:center;">请打开javascript支持以完整显示本站点</p>
            </noscript>
            <table ng-cloak>
                <colgroup>
                    <col id="name">
                    <col id="time-jp">
                    <col id="time-cn">
                    <col id="site">
                </colgroup>
                <thead>
                    <tr>
                        <th>作品名</th>
                        <th>
                            <span ng-click="order(bangumis,'jp',reversed)" 
                                ng-class="{'ordered':ordered==='jp'}">日本放送时间</span>
                        </th>
                        <th>
                            <span ng-click="order(bangumis,'cn',reversed)" 
                                ng-class="{'ordered':ordered==='cn'}">大陆放送时间</span>
                        </th>
                        <th>播放网址</th>
                    </tr>
                </thead>
                <tbody id="bangumi_list">
                    <tr class="errorMessage" ng-show="errorFlag===true"><td colspan="4">{{errorMessage}}</td></tr>
                    <tr ng-repeat="item in bangumis|filter:bgmFilter track by $index">
                        <td>
                            <a href="{{item.officalSite}}" ng-class="{'new':item.newBgm}" title="{{item.titleJP}}"
                                target="{{linkTarget}}">
                                {{item.titleCN}}
                            </a>
                        </td>
                        <td>{{item.weekDayJP|weekday}}&#160;&#160;{{item.timeJP|time}}</td>
                        <td>{{item.weekDayCN|weekday}}&#160;&#160;{{item.timeCN|time}}</td>
                        <td>
                            <ul class="link-list">
                                <li ng-repeat="site in item.onAirSite|linkFilter:siteList" 
                                    ng-class="{'lastLink':$last}">
                                    <a href="{{site}}" target="{{linkTarget}}" ng-click="linkHandler(site,$event)" 
                                        ng-class="{'disabled':site==='#'}">
                                        {{site|onair}}
                                    </a>
                                </li>
                            </ul>    
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p id="footer">&copy; 
            <a href="http://bgmlist.com/">番组放送</a> &#124; All Rights Reserved &#124; Powered by 
            <a href="https://angularjs.org/">AngularJS</a>
            and <a href="https://github.com/wxt2005/new_bangumi/">GitHub</a>
        </p>
        <script type="text/javascript" src="js/angular.min.js"></script> 
        <script type="text/javascript" src="js/angular-cookie.min.js"></script> 
        <script type="text/javascript" src="js/app.js"></script> 
        <script type="text/javascript" src="js/iefix.js"></script> 
    </body>
</html>
